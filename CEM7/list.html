<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=8">
  <title>项目列表</title>
  <link rel="stylesheet" type="text/css" href="Assets/css/reset.css" />
  <link rel="stylesheet" type="text/css" href="Assets/css/common.css" />
  <link rel="stylesheet" type="text/css" href="Assets/css/thems.css">
  <script type="text/javascript" src="Assets/js/jquery-1.8.3.min.js"></script>
  <script src="Assets/js/angular.js"></script>
  <!--框架高度设置-->
</head>
<style>
  .id {
    width: 5%;
  }

  /* 用户名 */

  .uname {
    width: 10%;
  }

  /* 项目名称 */

  .pname {
    width: 10%;
  }

  /* 项目所在路径 */

  .path {
    width: 10%;
  }

  /* 项目版本号 */

  .vnum {
    width: 10%;
  }

  /* 当前状态 */

  .status {
    width: 10%;
  }

  /* 项目创建时间 */

  .time {
    width: 10%;
  }

  /* 项目信息 */

  .msg {
    width: 10%;
  }

  /* 项目负责人 */

  .peo {
    width: 10%;
  }

  /* 项目状态 */

  .jstatus {
    width: 10%;
  }

  .jstatus a {
    padding: 5px;
    background-color: rgb(15, 192, 15);
    margin: 2px;
    color: #000;
    border-radius: 5px;
  }

  .jstatus .g {
    background-color: rgb(15, 192, 15);
  }

  .jstatus .dis {
    background-color: #ccc;
    pointer-events: none;
  }

  #box1 {
    position: relative;

  }

  #pagination_15 {
    float: right;
    margin-right: 20px;
  }

  .table {
    margin-top: 0;
    margin-bottom: 0;
  }

  .spanbtn {
    cursor: pointer;
  }

  ul li {
    float: left;
    height: 30px;
    line-height: 30px;
  }
</style>

<body ng-app="myApp" ng-controller="ctrl">
  <div id="right_ctn">
    <div class="right_m">
      <!--会议列表-->
      <div class="hy_list">
        <div class="box_t">
          <span class="name">项目列表</span>
        </div>
        <!--查询-->
        <div id="search">
          <div class="search search1">
            <span>按项目id查询：</span>
            <div class="s_text" id="box1">
              <input name="" type="text" id="txt1">
            </div>
            <a href="javascript:void(0);" class="btn" ng-click="search1($event)">查询</a>
          </div>
          <div class="search search2">
            <span>按项目名称查询：</span>
            <div class="s_text" id="box2">
              <input name="" type="text" id="txt2">
            </div>
            <a href="javascript:void(0);" class="btn" ng-click="search2($event)">查询</a>
          </div>
          <div class="search search3">
            <span>按项目负责人查询：</span>
            <div class="s_text" id="box3">
              <input name="" type="text" id="txt3">
            </div>
            <a href="javascript:void(0);" class="btn" ng-click="search3($event)">查询</a>
          </div>

        </div>

        <!--查询-->
        <div class="space_hx">&nbsp;</div>
        <!--列表-->
        <form action="" method="post">
          <table cellpadding="0" cellspacing="0" class="list_hy table" ng-cloak>
            <tr>
              <th class="id" scope="col">id</th>
              <th class="uname" scope="col">用户名</th>
              <th class="pname" scope="col">项目名称</th>
              <th class="path" scope="col">项目所在路径</th>
              <th class="vnum" scope="col">项目版本号</th>
              <th class="status" scope="col">当前状态</th>
              <th class="time" scope="col">项目创建时间</th>
              <th class="msg" scope="col">项目信息</th>
              <th class="peo" scope="col">项目负责人</th>
              <th class="jstatus" scope="col">项目状态</th>
            </tr>
          </table>
          <table cellpadding="0" cellspacing="0" class="list_hy table" id="table2" ng-cloak>
            <tr ng-repeat="item in classes" on-finish-rende>
              <td class="id">{{item.pro_id}}</td>
              <td class="uname">{{item.username}}</td>
              <td class="pname">{{item.pro.pro_name}}</td>
              <td class="path">{{item.pro.pro_path}}</td>
              <td class="vnum">{{item.score.chinese}}</td>
              <td class="status">{{item.pro.pro_flag}}</td>
              <td class="time">{{item.time}}</td>
              <td class="msg">{{item.pro.pro_list}}</td>
              <td class="peo">{{item.pro.pro_master}}</td>
              <td class="jstatus">
                <a href="./history.html" ng-class='{dis:item.pro.pro_flag}'>历史</a>
                <!-- 这里a标签的跳转路径和id有关系 -->
                <a href="./publish.html" class="g" ng-click="getid($event)">发布</a>
              </td>
              <!-- 类名为.g的按钮是绿色的 -->
            </tr>
          </table>
        </form>

        <!--列表-->
        <!--右边底部-->
        <div class="r_foot">
          <div class="r_foot_m">
            <!--分页-->
            <div class="page">

              <!-- 选中的时候，添加now类名 -->
              <ul>
                <li>
                  <span>共</span>
                  <span class="totalpage"></span>
                  <span>页</span>
                </li>
                <li>
                  <a href="" class="btn">
                    首页
                  </a>
                </li>
                <li>
                  <!-- 前一页 -->
                  <a href="" class="prev">
                    <img src="Assets/images/icon7.png" alt="" />
                  </a>
                </li>
                <li>
                  <!-- 后一页 -->
                  <a href="" class="next">
                    <img src="Assets/images/icon8.png" alt="" />
                  </a>
                </li>
                <li>

                  <a href="" class="btn">
                    尾页
                  </a>
                </li>

              </ul>
            </div>
            <!--分页-->
          </div>
        </div>
        <!--右边底部-->
      </div>
      <!--会议列表-->
    </div>
  </div>
  <!-- angualrjs相关配置 start -->
  <script>
    var zyApp = angular.module('myApp', []);
    zyApp.directive('onFinishRender', function ($timeout) {
      return {
        restrict: 'A',
        link: function (scope, element, attr) {
          if (scope.$last === true) {
            $timeout(function () {
              scope.$emit('ngRepeatFinished');

            });
          }
        }
      }
    })

    zyApp.controller("ctrl", function ($scope, $http) {
      $scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {
          var tr = $("#table2 tr");
          console.log("获取成功");
          console.log(tr.length);
        }),
        $http({
          methods: "get",
          url: "./Assets/json/list.json",
          params: {
            'devops_id': '1'
          }
        }).then(function (classes) {
          $scope.classes = classes.data;
          $scope.name = classes.data.name;
          //通过这种方式可以取到后台数据
          console.log($scope.classes[0].pro_id);
          //后台数据的赋值
          $scope.pagenum = 1;
          $scope.totalrow = 100;
          $scope.tatalpage = 20;

          //获取当前项目id值
          $scope.getid = function ($event) {
            console.log("触发成功");
            //获取当前点击元素的id值
            var proid = $($event.target).parent().parent().find(".id").text()
            console.log(proid);
            localStorage.setItem("proid", proid)
          }
          $(".r_foot .prev").click(function () {
            console.log("上一页");
            //可以直接获取$scope下的数据
            $scope.pagenum -= 1;
            if ($scope.pagenum < 1) {
              $scope.pagenum == 1;
            }
            console.log($scope.pagenum);
          })
          $(".r_foot .next").click(function () {
            console.log("下一页");
            //可以直接获取$scope下的数据
            $scope.pagenum += 1;
            if ($scope.pagenum > $scope.totalpage) {
              $scope.pagenum == $scope.totalpage
            }
            console.log($scope.pagenum);

          })
          $(".totalpage").text($scope.tatalpage)


          console.log("请求成功");
        }, function () {
          console.log("请求失败");
        });
    });
  </script>
  <!-- angualrjs相关配置 end -->

  <!-- 将页面中的数据存储到本地 start -->
  <script>
    window.onload = function () {
      console.log("全部加载完毕");
      var tr = $("#table2 tr");
      console.log(tr.length);
      //goPage(1);
      // localStorage.clear();
      //每行9个元素
      for (var i = 0; i < 9; i++) {
        //行数为tr的条数，排除第一行
        for (var j = 0; j < tr.length; j++) {
          var temp = tr[j].children[i].innerHTML;
          //将获取到的列表的内容存储到本地
          localStorage.setItem("listkey" + j + i, temp)
        }
      }
      //排他样式
      // var abtn = $(".r_foot a")
      // for (var i = 0; i < abtn.length; i++) {
      //   abtn[i].index = i;
      //   abtn[i].onclick = function () {
      //     for (var i = 0; i < abtn.length; i++) {
      //       abtn[i].className = "";
      //     }
      //     this.className = "now";
      //   }
      // }
      //逻辑
      // $(".r_foot .prev").click(function () {
      //   console.log("上一页");
      // })
      // $(".r_foot .next").click(function () {
      //   console.log("下一页");
      // })

      // $(".r_foot a").click(function () {
      //   console.log("被点击了");
      //   //获取当前页码
      //   var val = $(this).text();
      //   console.log(val);



      // })


    }
  </script>
  <script>
  </script>
</body>


</html>